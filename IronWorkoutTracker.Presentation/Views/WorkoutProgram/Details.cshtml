@using IronWorkoutTracker.Domain.Entities
@using IronWorkoutTracker.Presentation.ViewModels
@model WorkoutProgramDetailsViewModel

<div class="d-flex justify-content-between  mb-5">
    <h2>Workout Program Details</h2>
    <a asp-action="Index" asp-controller="Home" class="btn btn-secondary">Back to list</a>
    @if (Model.UserProgram == null)
    {
        <!-- Not adopted yet: show Adopt -->
        <form asp-controller="WorkoutProgram"
              asp-action="Adopt"
              asp-route-id="@Model.Program.WorkoutProgramId"
              method="post">
            <button type="submit" class="btn btn-secondary">Adopt</button>
        </form>
    }
    else
    {
        if (Model.UserProgram.Status == ProgramStatus.NotStarted)
        {
            <form asp-controller="WorkoutProgram"
                  asp-action="Start"
                  asp-route-id="@Model.UserProgram.UserProgramId"
                  method="post">
                <button type="submit" class="btn btn-primary">Start</button>
            </form>
        }
        else if (Model.UserProgram.Status == ProgramStatus.InProgress)
        {
            <form asp-controller="WorkoutProgram"
                  asp-action="Finish"
                  asp-route-id="@Model.UserProgram.UserProgramId"
                  method="post">
                <button type="submit" class="btn btn-success">Finish</button>
            </form>
        }
        else if (Model.UserProgram.Status == ProgramStatus.Finished)
        {
            <span class="badge bg-success">Finished</span>
        }
    }
</div>

<dl class="row">
    <dt class="col-sm-3">Name</dt>
    <dd class="col-sm-9">@Model.Program.Name</dd>

    <dt class="col-sm-3">Description</dt>
    <dd class="col-sm-9">@Model.Program.Description</dd>

    <dt class="col-sm-3">Visibility</dt>
    <dd class="col-sm-9">@Model.Program.Visibility</dd>

    <dt class="col-sm-3">Created By</dt>
    <dd class="col-sm-9">@Model.Program.CreatedBy?.Name</dd>

    <dt class="col-sm-3">Created Date</dt>
    <dd class="col-sm-9">@Model.Program.CreatedDate.ToString("dd MMM, yyyy")</dd>
</dl>


<!-- Add Day Button -->
<button type="button"
        class="btn btn-success mb-3"
        id="addDayBtn"
        data-action="Create"
        data-controller="ProgramDay"
        data-program-id="@Model.Program.WorkoutProgramId"
        data-bs-toggle="modal"
        data-bs-target="#GlobalModal">
    Add Day
</button>

<!-- Program Days Cards -->
<div class="d-flex flex-wrap gap-3 mb-4">
@foreach (var day in Model.Days)
{
    <div class="card" style="width: 18rem;" id="day-@day.ProgramDayId">
        <div class="card-body">
            <h5 class="card-title">@day.Title</h5>
            <p class="card-text">@day.Note</p>
            
            <button type="button"
                    class="btn btn-sm btn-primary"
                    data-action="EditModal"
                    data-controller="ProgramDay"
                    data-id="@day.ProgramDayId"
                    data-bs-toggle="modal"
                    data-bs-target="#GlobalModal">
                Edit
            </button>


            <form asp-controller="ProgramDay"
                  asp-action="Delete"
                  asp-route-id="@day.ProgramDayId"
                  method="post"
                  class="d-inline"
                  onsubmit="return confirm('Are you sure?');">
                <button type="submit" class="btn btn-sm btn-danger">Delete</button>
            </form>

             <a asp-controller="ProgramDayExercise"
               asp-action="Index"
               asp-route-programDayId="@day.ProgramDayId"
               class="btn btn-sm btn-info flex-grow-1">
                <i class="bi bi-gear"></i> Manage Exercises
            </a>
        </div>
    </div>
}
</div>

<!-- Modal -->
<div class="modal fade" id="GlobalModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content" id="modalContent">
            <!-- Loaded via AJAX -->
        </div>
    </div>
</div>